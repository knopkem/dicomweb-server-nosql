{"version":3,"sources":["webpack:///C:/dev/Viewers/extensions/dicom-html/src/TypedArrayProp.js","webpack:///C:/dev/Viewers/extensions/dicom-html/src/DicomHtmlViewport.js","webpack:///C:/dev/Viewers/extensions/dicom-html/src/ConnectedDicomHtmlViewport.js","webpack:///C:/dev/Viewers/extensions/dicom-html/src/OHIFDicomHtmlViewport.js"],"names":["TypedArrayProp","any","props","propName","componentName","obj","Float64Array","Float32Array","Int32Array","Int16Array","Int8Array","Uint32Array","Uint16Array","Uint8Array","Uint8ClampedArray","Error","float64","float32","float","int32","int16","int8","int","uint32","uint16","uint8","uint8clamped","uint","dcmjs","data","DicomMetaDictionary","DicomMessage","getMainDataItem","key","value","DicomHtmlViewport","content","error","setViewportActive","viewportIndex","activeViewportIndex","this","setContentFromByteArray","byteArray","arrayBuffer","buffer","dicomData","readFile","dataset","naturalizeDataset","dict","_meta","namifyDataset","meta","mainData","root","patientValue","PatientName","PatientSex","PatientID","push","studyValue","StudyDescription","seriesValue","SeriesDescription","SeriesNumber","manufacturerValue","Manufacturer","ManufacturerModelName","DeviceSerialNumber","mainDataObjects","CompletionFlag","VerificationFlag","Object","keys","forEach","item","contentDateTimeValue","ContentDate","ContentTime","getMainData","contentSequence","getContentSequence","header","level","ConceptNameCodeSequence","CodeMeaning","CodeValue","CodingSchemeDesignator","HeaderDynamicLevel","setState","state","data-cy","className","onClick","setViewportActiveHandler","onScroll","JSON","stringify","Component","PropTypes","func","isRequired","number","OHIF","redux","actions","ConnectedDicomHtmlViewport","connect","ownProps","viewports","dispatch","DicomLoaderService","utils","OHIFDicomHtmlViewport","viewportData","displaySet","studies","findDicomDataPromise","then","object"],"mappings":"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","file":"16.bundle.66b535cee0eb787277c6.js","sourcesContent":["// https://github.com/facebook/prop-types/issues/69\r\n\r\nexport const TypedArrayProp = {\r\n  any: (props, propName, componentName) => {\r\n    let obj = props[propName];\r\n    if (\r\n      !(\r\n        obj instanceof Float64Array ||\r\n        obj instanceof Float32Array ||\r\n        obj instanceof Int32Array ||\r\n        obj instanceof Int16Array ||\r\n        obj instanceof Int8Array ||\r\n        obj instanceof Uint32Array ||\r\n        obj instanceof Uint16Array ||\r\n        obj instanceof Uint8Array ||\r\n        obj instanceof Uint8ClampedArray\r\n      )\r\n    ) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected a typed array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  float64: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Float64Array)) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected a Float64Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  float32: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Float32Array)) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected a Float32Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  float: (props, propName, componentName) => {\r\n    if (\r\n      !(\r\n        props[propName] instanceof Float64Array ||\r\n        props[propName] instanceof Float32Array\r\n      )\r\n    ) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected a Float32Array or Float64Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  int32: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Int32Array)) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected an Int32Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  int16: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Int16Array)) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected an In16Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  int8: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Int8Array)) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected an Int8Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  int: (props, propName, componentName) => {\r\n    if (\r\n      !(\r\n        props[propName] instanceof Int32Array ||\r\n        props[propName] instanceof Int16Array ||\r\n        props[propName] instanceof Int8Array\r\n      )\r\n    ) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected an Int32Array, In16Array, or Int8Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  uint32: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Uint32Array)) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected a Uint32Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  uint16: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Uint16Array)) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected a Uint16Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  uint8: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Uint8Array)) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected a Uint8Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  uint8clamped: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Uint8ClampedArray)) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected a Uint8ClampedArray.'\r\n      );\r\n    }\r\n  },\r\n\r\n  uint: (props, propName, componentName) => {\r\n    if (\r\n      !(\r\n        props[propName] instanceof Uint32Array ||\r\n        props[propName] instanceof Uint16Array ||\r\n        props[propName] instanceof Uint8Array ||\r\n        props[propName] instanceof Uint8ClampedArray\r\n      )\r\n    ) {\r\n      return new Error(\r\n        'Invalid prop `' +\r\n          propName +\r\n          '` supplied to' +\r\n          ' `' +\r\n          componentName +\r\n          '`. Expected a Uint32Array, Uint16Array, Uint8Array, or Uint8ClampedArray.'\r\n      );\r\n    }\r\n  }\r\n};\r\n\r\nexport { TypedArrayProp as default };\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport dcmjs from 'dcmjs';\r\nimport TypedArrayProp from './TypedArrayProp';\r\n\r\nimport './DicomHtmlViewport.css';\r\n\r\nfunction getRelationshipString(data) {\r\n  switch (data.RelationshipType) {\r\n    case 'HAS CONCEPT MOD':\r\n      return 'Concept modifier: ';\r\n    case 'HAS OBS CONTEXT':\r\n      return 'Observation context: ';\r\n    default:\r\n      return '';\r\n  }\r\n}\r\n\r\nconst getMeaningString = data => {\r\n  if (data.ConceptNameCodeSequence) {\r\n    const { CodeMeaning } = data.ConceptNameCodeSequence;\r\n\r\n    return `${CodeMeaning} = `;\r\n  }\r\n\r\n  return '';\r\n};\r\n\r\nfunction getValueString(data) {\r\n  switch (data.ValueType) {\r\n    case 'CODE':\r\n      const {\r\n        CodeMeaning,\r\n        CodeValue,\r\n        CodingSchemeDesignator,\r\n      } = data.ConceptNameCodeSequence;\r\n\r\n      return `${CodeMeaning} (${CodeValue}, ${CodingSchemeDesignator})`;\r\n\r\n    case 'PNAME':\r\n      return data.PersonName;\r\n\r\n    case 'TEXT':\r\n      return data.TextValue;\r\n\r\n    case 'UIDREF':\r\n      return data.UID;\r\n\r\n    case 'NUM':\r\n      const { MeasuredValueSequence } = data;\r\n      const numValue = MeasuredValueSequence.NumericValue;\r\n      const codeValue =\r\n        MeasuredValueSequence.MeasurementUnitsCodeSequence.CodeValue;\r\n      return `${numValue} ${codeValue}`;\r\n  }\r\n}\r\n\r\nfunction constructPlainValue(data) {\r\n  const value = getValueString(data);\r\n\r\n  if (value) {\r\n    return getRelationshipString(data) + getMeaningString(data) + value;\r\n  }\r\n}\r\n\r\nfunction constructContentSequence(data, header) {\r\n  if (!data.ContentSequence) {\r\n    return;\r\n  }\r\n\r\n  const items = data.ContentSequence.map(item => parseContent(item)).filter(\r\n    item => item\r\n  );\r\n\r\n  if (!items.length) {\r\n    return;\r\n  }\r\n\r\n  const result = {\r\n    items,\r\n  };\r\n\r\n  if (header) {\r\n    result.header = header;\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction parseContent(data) {\r\n  if (data.ValueType) {\r\n    if (data.ValueType === 'CONTAINER') {\r\n      const header = data.ConceptNameCodeSequence.CodeMeaning;\r\n\r\n      return constructContentSequence(data, header);\r\n    }\r\n\r\n    return constructPlainValue(data);\r\n  }\r\n\r\n  if (data.ContentSequence) {\r\n    return constructContentSequence(data);\r\n  }\r\n}\r\n\r\nconst { DicomMetaDictionary, DicomMessage } = dcmjs.data;\r\n\r\nfunction getMainData(data) {\r\n  const root = [];\r\n\r\n  const patientValue = `${data.PatientName} (${data.PatientSex}, #${data.PatientID})`;\r\n  root.push(getMainDataItem('Patient', patientValue));\r\n\r\n  const studyValue = data.StudyDescription;\r\n  root.push(getMainDataItem('Study', studyValue));\r\n\r\n  const seriesValue = `${data.SeriesDescription} (#${data.SeriesNumber})`;\r\n  root.push(getMainDataItem('Series', seriesValue));\r\n\r\n  const manufacturerValue = `${data.Manufacturer} (${data.ManufacturerModelName}, #${data.DeviceSerialNumber})`;\r\n\r\n  root.push(getMainDataItem('Manufacturer', manufacturerValue));\r\n\r\n  const mainDataObjects = {\r\n    CompletionFlag: 'Completion flag',\r\n    VerificationFlag: 'Verification flag',\r\n  };\r\n\r\n  Object.keys(mainDataObjects).forEach(key => {\r\n    if (!data[key]) {\r\n      return;\r\n    }\r\n\r\n    const item = getMainDataItem(mainDataObjects[key], data[key]);\r\n\r\n    root.push(item);\r\n  });\r\n\r\n  // TODO: Format these dates\r\n  const contentDateTimeValue = `${data.ContentDate} ${data.ContentTime}`;\r\n  root.push(getMainDataItem('Content Date/Time', contentDateTimeValue));\r\n\r\n  root.push();\r\n\r\n  return <div>{root}</div>;\r\n}\r\n\r\nconst getContentSequence = (data, level = 1) => {\r\n  let header;\r\n\r\n  if (data.ConceptNameCodeSequence) {\r\n    const {\r\n      CodeMeaning,\r\n      CodeValue,\r\n      CodingSchemeDesignator,\r\n    } = data.ConceptNameCodeSequence;\r\n\r\n    header = `${CodeMeaning} (${CodeValue} - ${CodingSchemeDesignator})`;\r\n  }\r\n\r\n  const root = [];\r\n  if (header) {\r\n    const HeaderDynamicLevel = `h${level}`;\r\n\r\n    root.push(<HeaderDynamicLevel key={header}>{header}</HeaderDynamicLevel>);\r\n  }\r\n\r\n  Object.keys(data).forEach(key => {\r\n    const value = data[key];\r\n\r\n    let content;\r\n    if (value instanceof Object) {\r\n      content = getContentSequence(value, level + 1);\r\n    } else {\r\n      content = (\r\n        <div key={key}>\r\n          {key} - {data[key]}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    root.push(content);\r\n  });\r\n\r\n  return <div>{root}</div>;\r\n};\r\n\r\nfunction getMainDataItem(key, value) {\r\n  return (\r\n    <div key={key}>\r\n      <b>{key}</b>: {value}\r\n    </div>\r\n  );\r\n}\r\n\r\nclass DicomHtmlViewport extends Component {\r\n  state = {\r\n    content: null,\r\n    error: null,\r\n  };\r\n\r\n  static propTypes = {\r\n    byteArray: TypedArrayProp.uint8,\r\n    setViewportActive: PropTypes.func.isRequired,\r\n    viewportIndex: PropTypes.number.isRequired,\r\n    activeViewportIndex: PropTypes.number.isRequired,\r\n  };\r\n\r\n  componentDidMount() {\r\n    const dataSet = this.setContentFromByteArray(this.props.byteArray);\r\n  }\r\n\r\n  setContentFromByteArray(byteArray) {\r\n    const arrayBuffer = byteArray.buffer;\r\n    const dicomData = DicomMessage.readFile(arrayBuffer);\r\n    const dataset = DicomMetaDictionary.naturalizeDataset(dicomData.dict);\r\n    dataset._meta = DicomMetaDictionary.namifyDataset(dicomData.meta);\r\n\r\n    const mainData = getMainData(dataset);\r\n    const contentSequence = getContentSequence(dataset);\r\n    const content = (\r\n      <>\r\n        {mainData}\r\n        {contentSequence}\r\n      </>\r\n    );\r\n\r\n    this.setState({\r\n      content,\r\n    });\r\n  }\r\n\r\n  setViewportActiveHandler = () => {\r\n    const {\r\n      setViewportActive,\r\n      viewportIndex,\r\n      activeViewportIndex,\r\n    } = this.props;\r\n\r\n    if (viewportIndex !== activeViewportIndex) {\r\n      setViewportActive(viewportIndex);\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { content, error } = this.state;\r\n\r\n    return (\r\n      <div\r\n        data-cy=\"dicom-html-viewport\"\r\n        className=\"DicomHtmlViewport\"\r\n        onClick={this.setViewportActiveHandler}\r\n        onScroll={this.setViewportActiveHandler}\r\n      >\r\n        {content}\r\n        {error && <h2>{JSON.stringify(error)}</h2>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DicomHtmlViewport;\r\n","import OHIF from '@ohif/core';\r\nimport { connect } from 'react-redux';\r\nimport DicomHtmlViewport from './DicomHtmlViewport';\r\n\r\nconst { setViewportActive } = OHIF.redux.actions;\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  const { viewportIndex, byteArray } = ownProps;\r\n  const { activeViewportIndex } = state.viewports;\r\n\r\n  return {\r\n    viewportIndex,\r\n    activeViewportIndex,\r\n    byteArray,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch, ownProps) => {\r\n  const { viewportIndex } = ownProps;\r\n\r\n  return {\r\n    setViewportActive: () => {\r\n      dispatch(setViewportActive(viewportIndex));\r\n    },\r\n  };\r\n};\r\n\r\nconst ConnectedDicomHtmlViewport = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(DicomHtmlViewport);\r\n\r\nexport default ConnectedDicomHtmlViewport;\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport OHIF from '@ohif/core';\r\nimport ConnectedDicomHtmlViewport from './ConnectedDicomHtmlViewport';\r\n\r\nconst { DicomLoaderService } = OHIF.utils;\r\n\r\nclass OHIFDicomHtmlViewport extends Component {\r\n  static propTypes = {\r\n    studies: PropTypes.object,\r\n    displaySet: PropTypes.object,\r\n    viewportIndex: PropTypes.number,\r\n    viewportData: PropTypes.object,\r\n  };\r\n\r\n  state = {\r\n    byteArray: null,\r\n    error: null,\r\n  };\r\n\r\n  componentDidMount() {\r\n    const { displaySet, studies } = this.props.viewportData;\r\n\r\n    DicomLoaderService.findDicomDataPromise(displaySet, studies).then(\r\n      data => {\r\n        const byteArray = new Uint8Array(data);\r\n        this.setState({\r\n          byteArray: byteArray,\r\n        });\r\n      },\r\n      error => {\r\n        this.setState({\r\n          error,\r\n        });\r\n\r\n        throw new Error(error);\r\n      }\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        {this.state.byteArray && (\r\n          <ConnectedDicomHtmlViewport\r\n            byteArray={this.state.byteArray}\r\n            viewportIndex={this.props.viewportIndex}\r\n          />\r\n        )}\r\n        {this.state.error && <h2>{JSON.stringify(this.state.error)}</h2>}\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default OHIFDicomHtmlViewport;\r\n"],"sourceRoot":""}