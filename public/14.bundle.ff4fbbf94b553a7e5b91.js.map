{"version":3,"sources":["webpack:///C:/dev/Viewers/extensions/dicom-pdf/src/OHIFComponentPlugin.js","webpack:///C:/dev/Viewers/extensions/dicom-pdf/src/TypedArrayProp.js","webpack:///C:/dev/Viewers/extensions/dicom-pdf/src/DicomPDFViewport.js","webpack:///C:/dev/Viewers/extensions/dicom-pdf/src/OHIFDicomPDFViewport.js","webpack:///C:/dev/Viewers/extensions/dicom-pdf/src/ConnectedOHIFDicomPDFViewer.js"],"names":["OHIFComponentPlugin","props","Fragment","children","propTypes","id","PropTypes","string","isRequired","init","func","destroy","node","TypedArrayProp","any","propName","componentName","obj","Float64Array","Float32Array","Int32Array","Int16Array","Int8Array","Uint32Array","Uint16Array","Uint8Array","Uint8ClampedArray","Error","float64","float32","float","int32","int16","int8","int","uint32","uint16","uint8","uint8clamped","uint","pdfjsBuild","GlobalWorkerOptions","workerSrc","pdfjsWorker","SOP_CLASS_UIDS","ENCAPSULATED_PDF","DicomPDFViewport","state","pdf","scale","currentPageIndex","context","canvas","getContext","getPage","page","viewport","getViewport","height","width","renderContext","canvasContext","render","getTextContent","textContent","textLayer","innerHTML","style","PDFJS","renderTextLayer","container","textDivs","dataSet","byteArray","pdfByteArray","fileTag","elements","x00420011","offset","dataOffset","remainder","length","slice","PDF","Blob","type","URL","createObjectURL","event","newPageIndex","action","target","getAttribute","numPages","setState","newZoomValue","dicomParser","parseDicom","untilTag","error","setViewportActive","viewportIndex","activeViewportIndex","fileURL","a","document","createElement","href","download","substr","lastIndexOf","body","appendChild","click","removeChild","createRef","this","parseByteArray","getPDFFileUrl","useNative","getDocument","promise","updatePDFCanvas","prevProps","prevState","newValidScale","newValidPageNumber","className","onClick","setViewportActiveHandler","onScroll","aria-label","data","data-pager","onPageChange","onZoomChange","downloadPDFCanvas","ref","JSON","stringify","Component","bool","viewportData","object","number","DicomLoaderService","OHIF","utils","OHIFDicomPDFViewport","console","log","displaySet","studies","findDicomDataPromise","then","pluginProps","redux","actions","ConnectedOHIFDicomPDFViewer","connect","ownProps","viewports","dispatch"],"mappings":"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","file":"14.bundle.ff4fbbf94b553a7e5b91.js","sourcesContent":["import React from 'react';\r\nimport PropTypes from \"prop-types\";\r\n\r\nfunction OHIFComponentPlugin(props) {\r\n  return (<React.Fragment>{props.children}</React.Fragment>);\r\n}\r\n\r\nOHIFComponentPlugin.propTypes = {\r\n  id: PropTypes.string.isRequired,\r\n  init: PropTypes.func.isRequired,\r\n  destroy: PropTypes.func.isRequired,\r\n  children: PropTypes.node\r\n};\r\n\r\nexport default OHIFComponentPlugin;\r\n","// https://github.com/facebook/prop-types/issues/69\r\n\r\nexport const TypedArrayProp = {\r\n  any: (props, propName, componentName) => {\r\n    let obj = props[propName];\r\n    if (!(obj instanceof Float64Array ||\r\n      obj instanceof Float32Array ||\r\n      obj instanceof Int32Array ||\r\n      obj instanceof Int16Array ||\r\n      obj instanceof Int8Array ||\r\n      obj instanceof Uint32Array ||\r\n      obj instanceof Uint16Array ||\r\n      obj instanceof Uint8Array ||\r\n      obj instanceof Uint8ClampedArray)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected a typed array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  float64: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Float64Array)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected a Float64Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  float32: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Float32Array)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected a Float32Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  float: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Float64Array ||\r\n      props[propName] instanceof Float32Array)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected a Float32Array or Float64Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  int32: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Int32Array)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected an Int32Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  int16: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Int16Array)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected an In16Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  int8: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Int8Array)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected an Int8Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  int: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Int32Array ||\r\n      props[propName] instanceof Int16Array ||\r\n      props[propName] instanceof Int8Array)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected an Int32Array, In16Array, or Int8Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  uint32: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Uint32Array)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected a Uint32Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  uint16: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Uint16Array)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected a Uint16Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  uint8: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Uint8Array)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected a Uint8Array.'\r\n      );\r\n    }\r\n  },\r\n\r\n  uint8clamped: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Uint8ClampedArray)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected a Uint8ClampedArray.'\r\n      );\r\n    }\r\n  },\r\n\r\n  uint: (props, propName, componentName) => {\r\n    if (!(props[propName] instanceof Uint32Array ||\r\n      props[propName] instanceof Uint16Array ||\r\n      props[propName] instanceof Uint8Array ||\r\n      props[propName] instanceof Uint8ClampedArray)) {\r\n      return new Error(\r\n        'Invalid prop `' + propName + '` supplied to' +\r\n        ' `' + componentName + '`. Expected a Uint32Array, Uint16Array, Uint8Array, or Uint8ClampedArray.'\r\n      );\r\n    }\r\n  },\r\n};\r\n\r\nexport { TypedArrayProp as default };\r\n","import React, { Component, createRef } from 'react';\r\nimport dicomParser from 'dicom-parser';\r\nimport PDFJS from 'pdfjs-dist';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport TypedArrayProp from './TypedArrayProp';\r\nimport './DicomPDFViewport.css';\r\n\r\nimport pdfjsBuild from 'pdfjs-dist/build/pdf';\r\nimport pdfjsWorker from 'pdfjs-dist/build/pdf.worker.entry';\r\npdfjsBuild.GlobalWorkerOptions.workerSrc = pdfjsWorker;\r\n\r\n// TODO: Should probably use dcmjs for this\r\nconst SOP_CLASS_UIDS = {\r\n  ENCAPSULATED_PDF: '1.2.840.10008.5.1.4.1.1.104.1',\r\n};\r\n\r\nclass DicomPDFViewport extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      fileURL: null,\r\n      error: null,\r\n      currentPageIndex: 1,\r\n      pdf: null,\r\n      scale: 1,\r\n    };\r\n\r\n    this.canvas = createRef();\r\n    this.textLayer = createRef();\r\n  }\r\n\r\n  static propTypes = {\r\n    byteArray: TypedArrayProp.uint8,\r\n    useNative: PropTypes.bool,\r\n    viewportData: PropTypes.object,\r\n    activeViewportIndex: PropTypes.number,\r\n    setViewportActive: PropTypes.func,\r\n    viewportIndex: PropTypes.number,\r\n  };\r\n\r\n  static defaultProps = {\r\n    useNative: false,\r\n  };\r\n\r\n  async componentDidMount() {\r\n    const dataSet = this.parseByteArray(this.props.byteArray);\r\n    const fileURL = this.getPDFFileUrl(dataSet, this.props.byteArray);\r\n\r\n    this.setState(state => ({ ...state, fileURL }));\r\n\r\n    if (!this.props.useNative) {\r\n      const pdf = await PDFJS.getDocument(fileURL).promise;\r\n      this.setState(state => ({ ...state, pdf }), () => this.updatePDFCanvas());\r\n    }\r\n  }\r\n\r\n  updatePDFCanvas = async () => {\r\n    const { pdf, scale, currentPageIndex } = this.state;\r\n    const context = this.canvas.getContext('2d');\r\n\r\n    const page = await pdf.getPage(currentPageIndex);\r\n    let viewport = page.getViewport({ scale });\r\n\r\n    this.canvas.height = viewport.height;\r\n    this.canvas.width = viewport.width;\r\n\r\n    const renderContext = {\r\n      canvasContext: context,\r\n      viewport: viewport,\r\n    };\r\n\r\n    await page.render(renderContext);\r\n    const textContent = await page.getTextContent();\r\n\r\n    this.textLayer.innerHTML = '';\r\n    this.textLayer.style.height = viewport.height + 'px';\r\n    this.textLayer.style.width = viewport.width + 'px';\r\n\r\n    PDFJS.renderTextLayer({\r\n      textContent,\r\n      container: this.textLayer,\r\n      viewport,\r\n      textDivs: [],\r\n    });\r\n  };\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    const { currentPageIndex, scale } = this.state;\r\n    const newValidScale = prevState.scale !== scale && scale > 0;\r\n    const newValidPageNumber =\r\n      prevState.currentPageIndex !== currentPageIndex && currentPageIndex > 0;\r\n\r\n    if (newValidScale || newValidPageNumber) {\r\n      this.updatePDFCanvas();\r\n    }\r\n  }\r\n\r\n  getPDFFileUrl = (dataSet, byteArray) => {\r\n    let pdfByteArray = byteArray;\r\n\r\n    if (dataSet) {\r\n      const SOPClassUID = dataSet.string('x00080016');\r\n\r\n      if (SOPClassUID !== SOP_CLASS_UIDS.ENCAPSULATED_PDF) {\r\n        throw new Error('This is not a DICOM-encapsulated PDF');\r\n      }\r\n\r\n      const fileTag = dataSet.elements.x00420011;\r\n      const offset = fileTag.dataOffset;\r\n      const remainder = offset + fileTag.length;\r\n      pdfByteArray = dataSet.byteArray.slice(offset, remainder);\r\n    }\r\n\r\n    const PDF = new Blob([pdfByteArray], { type: 'application/pdf' });\r\n    const fileURL = URL.createObjectURL(PDF);\r\n\r\n    return fileURL;\r\n  };\r\n\r\n  onPageChange = async event => {\r\n    const { currentPageIndex, pdf } = this.state;\r\n    let newPageIndex = currentPageIndex;\r\n\r\n    const action = event.target.getAttribute('data-pager');\r\n    if (action === 'prev') {\r\n      if (currentPageIndex === 1) {\r\n        return;\r\n      }\r\n      newPageIndex -= 1;\r\n      if (currentPageIndex < 0) {\r\n        newPageIndex = 0;\r\n      }\r\n    }\r\n\r\n    if (action === 'next') {\r\n      if (currentPageIndex === pdf.numPages - 1) {\r\n        return;\r\n      }\r\n      newPageIndex += 1;\r\n      if (currentPageIndex > pdf.numPages - 1) {\r\n        newPageIndex = pdf.numPages - 1;\r\n      }\r\n    }\r\n\r\n    this.setState(state => ({ ...state, currentPageIndex: newPageIndex }));\r\n  };\r\n\r\n  onZoomChange = () => {\r\n    let newZoomValue = this.state.scale;\r\n\r\n    const action = event.target.getAttribute('data-pager');\r\n\r\n    if (action === '+') {\r\n      newZoomValue += 0.25;\r\n    }\r\n\r\n    if (action === '-') {\r\n      newZoomValue -= 0.25;\r\n    }\r\n\r\n    this.setState(state => ({ ...state, scale: newZoomValue }));\r\n  };\r\n\r\n  parseByteArray = byteArray => {\r\n    const options = { untilTag: '' };\r\n\r\n    let dataSet;\r\n    try {\r\n      dataSet = dicomParser.parseDicom(byteArray, options);\r\n    } catch (error) {\r\n      this.setState(state => ({ ...state, error }));\r\n    }\r\n\r\n    return dataSet;\r\n  };\r\n\r\n  setViewportActiveHandler = () => {\r\n    const {\r\n      setViewportActive,\r\n      viewportIndex,\r\n      activeViewportIndex,\r\n    } = this.props;\r\n\r\n    if (viewportIndex !== activeViewportIndex) {\r\n      setViewportActive(viewportIndex);\r\n    }\r\n  };\r\n\r\n  downloadPDFCanvas = () => {\r\n    const { fileURL } = this.state;\r\n    const a = document.createElement('a');\r\n    a.href = fileURL;\r\n    a.download = fileURL.substr(fileURL.lastIndexOf('/') + 1);\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n  };\r\n\r\n  render() {\r\n    const { fileURL, pdf, error } = this.state;\r\n\r\n    return (\r\n      <div\r\n        className={'DicomPDFViewport'}\r\n        onClick={this.setViewportActiveHandler}\r\n        onScroll={this.setViewportActiveHandler}\r\n        style={{ width: '100%', height: '100%' }}\r\n      >\r\n        {!this.props.useNative ? (\r\n          <>\r\n            <div id=\"toolbar\">\r\n              <div id=\"pager\">\r\n                {pdf && pdf.numPages > 1 && (\r\n                  <>\r\n                    <button data-pager=\"prev\" onClick={this.onPageChange}>\r\n                      {`<`}\r\n                    </button>\r\n                    <button data-pager=\"next\" onClick={this.onPageChange}>\r\n                      {`>`}\r\n                    </button>\r\n                  </>\r\n                )}\r\n                <button data-pager=\"-\" onClick={this.onZoomChange}>\r\n                  {`-`}\r\n                </button>\r\n                <button data-pager=\"+\" onClick={this.onZoomChange}>\r\n                  {`+`}\r\n                </button>\r\n                <button onClick={this.downloadPDFCanvas}>Download</button>\r\n              </div>\r\n            </div>\r\n            <div id=\"canvas\">\r\n              <div id=\"pdf-canvas-container\">\r\n                <canvas\r\n                  id=\"pdf-canvas\"\r\n                  ref={canvas => (this.canvas = canvas)}\r\n                />\r\n                <div\r\n                  id=\"text-layer\"\r\n                  ref={textLayer => (this.textLayer = textLayer)}\r\n                ></div>\r\n              </div>\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <object\r\n            aria-label=\"PDF Viewer\"\r\n            data={fileURL}\r\n            type=\"application/pdf\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n          />\r\n        )}\r\n        {error && <h2>{JSON.stringify(error)}</h2>}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DicomPDFViewport;\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport OHIF from '@ohif/core';\r\nimport OHIFComponentPlugin from './OHIFComponentPlugin.js';\r\nimport DicomPDFViewport from './DicomPDFViewport';\r\n\r\nconst { DicomLoaderService } = OHIF.utils;\r\n\r\nclass OHIFDicomPDFViewport extends Component {\r\n  static propTypes = {\r\n    studies: PropTypes.object,\r\n    displaySet: PropTypes.object,\r\n    viewportIndex: PropTypes.number,\r\n    viewportData: PropTypes.object,\r\n    activeViewportIndex: PropTypes.number,\r\n    setViewportActive: PropTypes.func,\r\n  };\r\n\r\n  state = {\r\n    byteArray: null,\r\n    error: null,\r\n  };\r\n\r\n  static id = 'DicomPDFViewportPDF';\r\n\r\n  static init() {\r\n    console.log('DicomPDFViewport init()');\r\n  }\r\n\r\n  static destroy() {\r\n    console.log('DicomPDFViewport destroy()');\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { displaySet, studies } = this.props.viewportData;\r\n\r\n    DicomLoaderService.findDicomDataPromise(displaySet, studies).then(\r\n      data => this.setState({ byteArray: new Uint8Array(data) }),\r\n      error => {\r\n        this.setState({ error });\r\n        throw new Error(error);\r\n      }\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      setViewportActive,\r\n      viewportIndex,\r\n      activeViewportIndex,\r\n    } = this.props;\r\n    const { byteArray, error } = this.state;\r\n    const { id, init, destroy } = OHIFDicomPDFViewport;\r\n    const pluginProps = { id, init, destroy };\r\n\r\n    return (\r\n      <OHIFComponentPlugin {...pluginProps}>\r\n        {byteArray && (\r\n          <DicomPDFViewport\r\n            byteArray={byteArray}\r\n            setViewportActive={setViewportActive}\r\n            viewportIndex={viewportIndex}\r\n            activeViewportIndex={activeViewportIndex}\r\n          />\r\n        )}\r\n        {error && <h2>{JSON.stringify(error)}</h2>}\r\n      </OHIFComponentPlugin>\r\n    );\r\n  }\r\n}\r\n\r\nexport default OHIFDicomPDFViewport;\r\n","import OHIF from '@ohif/core';\r\nimport { connect } from 'react-redux';\r\nimport OHIFDicomPDFViewport from './OHIFDicomPDFViewport';\r\n\r\nconst { setViewportActive } = OHIF.redux.actions;\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  const { activeViewportIndex } = state.viewports;\r\n  return { activeViewportIndex };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch, ownProps) => {\r\n  const { viewportIndex } = ownProps;\r\n\r\n  return {\r\n    setViewportActive: () => {\r\n      dispatch(setViewportActive(viewportIndex));\r\n    },\r\n  };\r\n};\r\n\r\nconst ConnectedOHIFDicomPDFViewer = connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(OHIFDicomPDFViewport);\r\n\r\nexport default ConnectedOHIFDicomPDFViewer;\r\n"],"sourceRoot":""}