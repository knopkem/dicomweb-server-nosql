{"version":3,"sources":["webpack:///./routes/StandaloneRouting.js","webpack:///./connectedComponents/ConnectedStandaloneRouting.js","webpack:///C:/dev/Viewers/node_modules/querystring-es3/index.js","webpack:///C:/dev/Viewers/node_modules/querystring-es3/decode.js","webpack:///C:/dev/Viewers/node_modules/querystring-es3/encode.js"],"names":["log","OHIF","metadata","studyMetadataManager","utils","OHIFStudyMetadata","StandaloneRouting","studies","server","studyInstanceUIDs","seriesInstanceUIDs","error","loading","query","Promise","resolve","reject","url","Error","oReq","XMLHttpRequest","addEventListener","warn","event","target","status","responseText","info","JSON","stringify","data","parse","servers","dicomWeb","type","props","activateServer","split","StudyInstanceUID","SeriesInstanceUID","metadataProvider","cornerstone","forEach","study","series","instances","instance","imageId","naturalizedDicom","addInstance","addImageIdToUIDs","SOPInstanceUID","open","setRequestHeader","send","search","this","location","slice","length","qs","parseQueryAndRetrieveDICOMWebData","_mapStudiesToNewFormat","updatedStudies","updatedStudiesInstanceUIDs","setState","message","state","NotFound","showGoBackButton","ConnectedViewer","ConnectedViewerRetrieveStudyData","Component","PropTypes","object","store","setServers","func","purge","uniqueStudyUIDs","Set","map","studyMetadata","sopClassHandlerModules","extensionManager","modules","displaySets","createDisplaySets","add","Array","from","ConnectedStandaloneRouting","connect","dispatch","exports","decode","encode","hasOwnProperty","obj","prop","Object","prototype","call","module","sep","eq","options","regexp","maxKeys","len","i","kstr","vstr","k","v","x","replace","idx","indexOf","substr","decodeURIComponent","isArray","push","xs","toString","stringifyPrimitive","isFinite","name","undefined","objectKeys","ks","encodeURIComponent","join","f","res","keys","key"],"mappings":"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","file":"ConnectedStandaloneRouting.bundle.7375523184d527711a01.js","sourcesContent":["import React, { Component } from 'react';\r\nimport OHIF from '@ohif/core';\r\nimport PropTypes from 'prop-types';\r\nimport qs from 'querystring';\r\n\r\nimport { extensionManager } from './../App.js';\r\nimport ConnectedViewer from '../connectedComponents/ConnectedViewer';\r\nimport ConnectedViewerRetrieveStudyData from '../connectedComponents/ConnectedViewerRetrieveStudyData';\r\nimport NotFound from '../routes/NotFound';\r\n\r\nconst { log, metadata, utils } = OHIF;\r\nconst { studyMetadataManager } = utils;\r\nconst { OHIFStudyMetadata } = metadata;\r\n\r\nclass StandaloneRouting extends Component {\r\n  state = {\r\n    studies: null,\r\n    server: null,\r\n    studyInstanceUIDs: null,\r\n    seriesInstanceUIDs: null,\r\n    error: null,\r\n    loading: true,\r\n  };\r\n\r\n  static propTypes = {\r\n    location: PropTypes.object,\r\n    store: PropTypes.object,\r\n    setServers: PropTypes.func,\r\n  };\r\n\r\n  parseQueryAndRetrieveDICOMWebData(query) {\r\n    return new Promise((resolve, reject) => {\r\n      const url = query.url;\r\n\r\n      if (!url) {\r\n        return reject(new Error('No URL was specified. Use ?url=$yourURL'));\r\n      }\r\n\r\n      // Define a request to the server to retrieve the study data\r\n      // as JSON, given a URL that was in the Route\r\n      const oReq = new XMLHttpRequest();\r\n\r\n      // Add event listeners for request failure\r\n      oReq.addEventListener('error', error => {\r\n        log.warn('An error occurred while retrieving the JSON data');\r\n        reject(error);\r\n      });\r\n\r\n      // When the JSON has been returned, parse it into a JavaScript Object\r\n      // and render the OHIF Viewer with this data\r\n      oReq.addEventListener('load', event => {\r\n        if (event.target.status === 404) {\r\n          reject(new Error('No JSON data found'));\r\n        }\r\n\r\n        // Parse the response content\r\n        // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText\r\n        if (!oReq.responseText) {\r\n          log.warn('Response was undefined');\r\n          reject(new Error('Response was undefined'));\r\n        }\r\n\r\n        log.info(JSON.stringify(oReq.responseText, null, 2));\r\n\r\n        const data = JSON.parse(oReq.responseText);\r\n        if (data.servers) {\r\n          if (!query.studyInstanceUIDs) {\r\n            log.warn('No study instance uids specified');\r\n            reject(new Error('No study instance uids specified'));\r\n          }\r\n\r\n          const server = data.servers.dicomWeb[0];\r\n          server.type = 'dicomWeb';\r\n\r\n          log.warn('Activating server', server);\r\n          this.props.activateServer(server);\r\n\r\n          const studyInstanceUIDs = query.studyInstanceUIDs.split(';');\r\n          const seriesInstanceUIDs = query.seriesInstanceUIDs\r\n            ? query.seriesInstanceUIDs.split(';')\r\n            : [];\r\n\r\n          resolve({ server, studyInstanceUIDs, seriesInstanceUIDs });\r\n        } else {\r\n          // Parse data here and add to metadata provider.\r\n          const metadataProvider = OHIF.cornerstone.metadataProvider;\r\n\r\n          let StudyInstanceUID;\r\n          let SeriesInstanceUID;\r\n\r\n          data.studies.forEach(study => {\r\n            StudyInstanceUID = study.StudyInstanceUID;\r\n\r\n            study.series.forEach(series => {\r\n              SeriesInstanceUID = series.SeriesInstanceUID;\r\n\r\n              series.instances.forEach(instance => {\r\n                const { url: imageId, metadata: naturalizedDicom } = instance;\r\n\r\n                // Add instance to metadata provider.\r\n                metadataProvider.addInstance(naturalizedDicom);\r\n                // Add imageId specific mapping to this data as the URL isn't necessarliy WADO-URI.\r\n                metadataProvider.addImageIdToUIDs(imageId, {\r\n                  StudyInstanceUID,\r\n                  SeriesInstanceUID,\r\n                  SOPInstanceUID: naturalizedDicom.SOPInstanceUID,\r\n                });\r\n              });\r\n            });\r\n          });\r\n\r\n          resolve({ studies: data.studies, studyInstanceUIDs: [] });\r\n        }\r\n      });\r\n\r\n      // Open the Request to the server for the JSON data\r\n      // In this case we have a server-side route called /api/\r\n      // which responds to GET requests with the study data\r\n      log.info(`Sending Request to: ${url}`);\r\n      oReq.open('GET', url);\r\n      oReq.setRequestHeader('Accept', 'application/json');\r\n\r\n      // Fire the request to the server\r\n      oReq.send();\r\n    });\r\n  }\r\n\r\n  async componentDidMount() {\r\n    try {\r\n      let { search } = this.props.location;\r\n\r\n      // Remove ? prefix which is included for some reason\r\n      search = search.slice(1, search.length);\r\n      const query = qs.parse(search);\r\n\r\n      let {\r\n        server,\r\n        studies,\r\n        studyInstanceUIDs,\r\n        seriesInstanceUIDs,\r\n      } = await this.parseQueryAndRetrieveDICOMWebData(query);\r\n\r\n      if (studies) {\r\n        const {\r\n          studies: updatedStudies,\r\n          studyInstanceUIDs: updatedStudiesInstanceUIDs,\r\n        } = _mapStudiesToNewFormat(studies);\r\n        studies = updatedStudies;\r\n        studyInstanceUIDs = updatedStudiesInstanceUIDs;\r\n      }\r\n\r\n      this.setState({\r\n        studies,\r\n        server,\r\n        studyInstanceUIDs,\r\n        seriesInstanceUIDs,\r\n        loading: false,\r\n      });\r\n    } catch (error) {\r\n      this.setState({ error: error.message, loading: false });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const message = this.state.error\r\n      ? `Error: ${JSON.stringify(this.state.error)}`\r\n      : 'Loading...';\r\n    if (this.state.error || this.state.loading) {\r\n      return <NotFound message={message} showGoBackButton={this.state.error} />;\r\n    }\r\n\r\n    return this.state.studies ? (\r\n      <ConnectedViewer studies={this.state.studies} />\r\n    ) : (\r\n      <ConnectedViewerRetrieveStudyData\r\n        studyInstanceUIDs={this.state.studyInstanceUIDs}\r\n        seriesInstanceUIDs={this.state.seriesInstanceUIDs}\r\n        server={this.state.server}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nconst _mapStudiesToNewFormat = studies => {\r\n  studyMetadataManager.purge();\r\n\r\n  /* Map studies to new format, update metadata manager? */\r\n  const uniqueStudyUIDs = new Set();\r\n  const updatedStudies = studies.map(study => {\r\n    const studyMetadata = new OHIFStudyMetadata(study, study.StudyInstanceUID);\r\n\r\n    const sopClassHandlerModules =\r\n      extensionManager.modules['sopClassHandlerModule'];\r\n    study.displaySets =\r\n      study.displaySets ||\r\n      studyMetadata.createDisplaySets(sopClassHandlerModules);\r\n\r\n    studyMetadataManager.add(studyMetadata);\r\n    uniqueStudyUIDs.add(study.StudyInstanceUID);\r\n\r\n    return study;\r\n  });\r\n\r\n  return {\r\n    studies: updatedStudies,\r\n    studyInstanceUIDs: Array.from(uniqueStudyUIDs),\r\n  };\r\n};\r\n\r\nexport default StandaloneRouting;\r\n","import { connect } from 'react-redux';\r\nimport StandaloneRouting from '../routes/StandaloneRouting';\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return {\r\n    activateServer: server => {\r\n      const action = {\r\n        type: 'ACTIVATE_SERVER',\r\n        server,\r\n      };\r\n      dispatch(action);\r\n    },\r\n  };\r\n};\r\n\r\nconst ConnectedStandaloneRouting = connect(\r\n  null,\r\n  mapDispatchToProps\r\n)(StandaloneRouting);\r\n\r\nexport default ConnectedStandaloneRouting;\r\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n"],"sourceRoot":""}